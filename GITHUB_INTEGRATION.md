# GitHub Integration Guide

## ğŸš€ Automatic PR Review & Index Updates

Droog AI can be integrated with GitHub to automatically:
1. **Review PRs** when they're opened or updated
2. **Update index** when code is merged to main branch

---

## ğŸ“‹ Quick Setup

### Option 1: Automatic Setup (Recommended)

```bash
# In your project directory
droog setup-github
```

This creates:
- `.github/workflows/droog-review.yml` - PR review workflow
- `.github/workflows/droog-index.yml` - Index update workflow

### Option 2: Manual Setup

Copy the workflow files from Droog AI's `.github/workflows/` directory to your project.

---

## ğŸ”§ Configuration

### Step 1: Add GitHub Secrets

Go to your repository: **Settings â†’ Secrets and variables â†’ Actions**

Add these secrets:

1. **GEMINI_API_KEY**
   - Click "New repository secret"
   - Name: `GEMINI_API_KEY`
   - Value: Your Gemini API key
   - Click "Add secret"

2. **GITHUB_TOKEN** (Optional)
   - Usually auto-generated by GitHub Actions
   - If needed, create Personal Access Token with `repo` permissions

### Step 2: Verify Workflows

1. Go to **Actions** tab in your repository
2. You should see:
   - "Droog AI Code Review" workflow
   - "Droog AI Index Update" workflow

---

## ğŸ¯ How It Works

### PR Review Workflow

**Triggers:**
- PR opened
- PR updated (new commits)
- PR reopened
- Manual trigger (workflow_dispatch)

**What it does:**
1. Checks out code
2. Installs dependencies
3. Builds Droog AI
4. Runs enterprise review
5. Posts comments to PR
6. Uploads review report as artifact

**Result:**
- Comments posted on PR with issues found
- Review report available as artifact
- PR summary comment added

### Index Update Workflow

**Triggers:**
- Code pushed to `main` or `master` branch
- Manual trigger (workflow_dispatch)

**What it does:**
1. Checks out code
2. Installs dependencies
3. Builds Droog AI
4. Indexes the branch
5. Commits and pushes `.droog-embeddings.json`

**Result:**
- Index file updated in repository
- Available for cross-repo duplicate detection
- Automatically used in next PR review

---

## ğŸ“Š Workflow Details

### PR Review Workflow

```yaml
name: Droog AI Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened]
```

**Features:**
- âœ… Automatic review on PR open/update
- âœ… Posts comments to PR
- âœ… Uploads review report
- âœ… Adds PR summary comment
- âœ… Uses index if available

### Index Update Workflow

```yaml
name: Droog AI Index Update

on:
  push:
    branches: [main, master]
```

**Features:**
- âœ… Automatic index update on merge
- âœ… Commits index file to repo
- âœ… Available for all PRs
- âœ… Manual trigger option

---

## ğŸ” Testing the Integration

### Test PR Review

1. Create a test PR
2. Workflow should trigger automatically
3. Check **Actions** tab for progress
4. Check PR for comments

### Test Index Update

1. Merge a PR to main
2. Workflow should trigger automatically
3. Check for `.droog-embeddings.json` commit
4. Verify index file exists in repo

### Manual Trigger

**PR Review:**
1. Go to **Actions** â†’ **Droog AI Code Review**
2. Click **Run workflow**
3. Enter PR number
4. Click **Run workflow**

**Index Update:**
1. Go to **Actions** â†’ **Droog AI Index Update**
2. Click **Run workflow**
3. Select branch (default: main)
4. Click **Run workflow**

---

## ğŸ›ï¸ Customization

### Customize Review Settings

Edit `.github/workflows/droog-review.yml`:

```yaml
- name: Run Droog AI Review
  run: |
    # Add custom flags
    node dist/index.js review \
      --repo "${{ github.repository }}" \
      --pr "${PR_NUMBER}" \
      --enterprise \
      --post \
      --threshold high  # Only high severity issues
```

### Customize Index Settings

Edit `.github/workflows/droog-index.yml`:

```yaml
- name: Update Index
  run: |
    # Index specific paths only
    node dist/index.js index \
      --repo "${{ github.repository }}" \
      --branch "${BRANCH}" \
      --path "src/main"
```

### Disable Auto-Review for Specific PRs

Add to PR description:
```
[droog-skip]
```

Then modify workflow to check for this tag.

---

## ğŸ› Troubleshooting

### Workflow Not Triggering

**Check:**
1. Workflow files in `.github/workflows/`
2. File names: `droog-review.yml`, `droog-index.yml`
3. YAML syntax is correct
4. Secrets are added

### Review Not Posting Comments

**Check:**
1. `GITHUB_TOKEN` has `pull-requests: write` permission
2. PR is not from fork (forks have limited permissions)
3. Check workflow logs for errors

### Index Not Updating

**Check:**
1. `GITHUB_TOKEN` has `contents: write` permission
2. Branch is `main` or `master`
3. Check workflow logs for errors

### Rate Limit Issues

**Solutions:**
1. Use paid Gemini API tier
2. Reduce review frequency
3. Add delays between reviews
4. Use caching

---

## ğŸ“ˆ Best Practices

### 1. Start with Manual Trigger
- Test workflows manually first
- Verify secrets are working
- Check permissions

### 2. Monitor First Few PRs
- Check review quality
- Adjust thresholds if needed
- Gather team feedback

### 3. Set Up Notifications
- GitHub notifications for workflow failures
- Slack/Teams integration for reviews

### 4. Regular Index Updates
- Index updates automatically on merge
- Can manually trigger if needed
- Keep index up-to-date for better duplicate detection

### 5. Review Workflow Logs
- Check logs for errors
- Monitor API usage
- Optimize if needed

---

## ğŸ”’ Security Considerations

### Secrets Management
- âœ… Never commit API keys
- âœ… Use GitHub Secrets
- âœ… Rotate keys regularly
- âœ… Use minimal permissions

### Permissions
- âœ… Use least privilege principle
- âœ… Review workflow permissions
- âœ… Limit token scope

### Code Access
- âœ… Workflows run in isolated environment
- âœ… Code is checked out fresh each time
- âœ… No persistent storage

---

## ğŸ“ Example Workflow Run

### PR Review Example

```
ğŸ” Reviewing PR #123...
ğŸ“‹ Phase 0: Collecting All Data & Building Context...
âœ“ Extracted 45 symbols from 12 PR files
âœ“ Loaded 1200 symbols from main branch index
ğŸ“‹ Phase 1: AI Review (with Full Context)...
âœ“ Found 8 issues (2 high, 4 medium, 2 low)
ğŸ“‹ Phase 2: Advanced Analysis...
âœ“ Found 3 security issues
âœ“ Found 2 performance issues
âœ… Review complete! Comments posted to PR.
```

### Index Update Example

```
ğŸ“¦ Indexing branch: main...
ğŸ“¥ Fetching repository tree...
âœ“ Found 150 files to index
âœ“ Processed 150 files (2500 symbols)
âœ… Indexing complete!
ğŸ¤– Committed index to repository
```

---

## ğŸš€ Next Steps

1. âœ… Setup workflows (`droog setup-github`)
2. âœ… Add secrets (GEMINI_API_KEY)
3. âœ… Test with a PR
4. âœ… Monitor first few reviews
5. âœ… Gather team feedback
6. âœ… Adjust settings if needed
7. âœ… Roll out to all teams

---

## ğŸ“ Support

- **Issues**: Create GitHub issue
- **Documentation**: See INSTALLATION.md
- **Features**: See SENIOR_ARCHITECT_IMPLEMENTATION_PLAN.md

---

**Happy reviewing! ğŸ¤–**







